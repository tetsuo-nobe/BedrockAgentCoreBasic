# AgentCore の Runtime の同期呼び出しのタイムアウト(15分）エラー発生の確認

```
agentcore create
```

```
export AWS_REGION=us-east-1
```

```
agentcore invoke --dev "こんにちは!" --port 8081
```

```
agentcore deploy
```

```
agentcore invoke '{"prompt": "こんにちは！日本の首都はどこですか？"}'
```

```
agentcore invoke '{"prompt": "timeout"}'
```


* Runtimeの同期呼び出しの 15分 のタイムアウトエラー

```
botocore.errorfactory.RuntimeClientError: An error occurred (RuntimeClientError) when calling the InvokeAgentRuntime operation (reached max retries: 0): Request timed out as the agent didn't have a response byte in last 15 mins.
```

* 下記は boto3の READ TIMEOUT 発生時のエラーなので、Runtime のタイムアウトではない

```
botocore.exceptions.ReadTimeoutError: Read timeout on endpoint URL: "https://bedrock-agentcore.us-east-1.amazonaws.com/runtimes/arn%3Aaws%3Abedrock-agentcore%3Aus-east-1%3A068048081706%3Aruntime%2FtimeoutTest_Agent-xSlEd4GQ5b/invocations"
```

boto3 の READ TIMEOUT の値は下記のように設定できる
```
# 設定の定義
my_config = Config(
    connect_timeout=5,  # 接続タイムアウト (秒)
    read_timeout=1200,   # 読み込みタイムアウト (秒) 
    retries={
        'mode': 'standard', # リトライモード ('legacy', 'standard', 'adaptive')
        'total_max_attempts': 1 # 最大試行回数
    }
)

client = boto3.client('bedrock-agentcore', region_name='us-east-1', config=my_config)
```

This is a project generated by the agentcore create --template basic CLI tool!

# Layout

There are two directories generated, `src/` and `test/`. At the root, there is a `.gitignore` file, a `.bedrock_agentcore.yaml` file
which is used for other `agentcore` commands like `deploy`, `dev`, and `invoke`.

## src/

The main entrypoint to your app is defined in `src/main.py`. Using the AgentCore SDK `@app.entrypoint` decorator, this file defines a Starlette ASGI app with the chosen Agent framework SDK
running within.

`src/mcp_client/client.py` implements an MCP client using the library from your chosen Agent framework SDK.

`src/model/load.py` instantiates your chosen model provider.

## test/

Tests are not defined by default. Add your own pytest definitions here.

# Developing locally

If installation was successful, a virtual environment is already created with dependencies installed.

Run `source .venv/bin/activate` before developing.

`agentcore dev` will start a local server on 0.0.0.0:8080.

In a new terminal, you can invoke that server with:

`agentcore invoke --dev "What can you do"`

# Deployment

If you want to customize your project, you can first run `agentcore configure` before deploying. Otherwise, the default project settings
will work out of the box.

After providing credentials, `agentcore deploy` will deploy your project into Amazon Bedrock AgentCore.

Use `agentcore invoke` to invoke your deployed agent.